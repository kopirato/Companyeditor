<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Selelo Media Enhancer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    font-family:Arial, sans-serif;
    background:#020617;
    color:white;
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
}

.box{
    background:#020617;
    border:1px solid #0f172a;
    padding:25px;
    width:100%;
    max-width:450px;
    border-radius:12px;
    text-align:center;
}

h2{color:#38bdf8;}

input{
    width:100%;
    margin:15px 0;
}

canvas{
    width:100%;
    display:none;
    margin-top:15px;
    border-radius:8px;
}

button{
    background:#38bdf8;
    border:none;
    padding:12px;
    width:100%;
    font-weight:bold;
    border-radius:8px;
    cursor:pointer;
    margin-top:15px;
}

button:disabled{
    background:#64748b;
}
</style>
</head>

<body>

<div class="box">

<h2>Selelo Media Enhancer</h2>
<p>Upload → Enhance → Brand → Download</p>

<input type="file" id="upload" accept="image/*">

<canvas id="canvas"></canvas>

<button id="download" disabled>
Download Branded Image
</button>

<p id="status"></p>

</div>


<script>

const upload = document.getElementById("upload");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const downloadBtn = document.getElementById("download");
const status = document.getElementById("status");

let finalBlob = null;


// Load your real logo
const logo = new Image();
logo.src = "11.png";

logo.onload = ()=>console.log("Logo loaded");
logo.onerror = ()=>alert("ERROR: 11.png not found in repo root");


// Upload
upload.addEventListener("change", e=>{

    const file = e.target.files[0];
    if(!file) return;

    status.textContent = "Processing...";

    const img = new Image();

    img.onload = ()=>{

        canvas.width = img.width;
        canvas.height = img.height;

        canvas.style.display = "block";

        // Draw base image
        ctx.drawImage(img,0,0);

        enhanceImage();

        if(logo.complete){
            addLogo();
        }

        // Convert to blob (Android-safe)
        canvas.toBlob(blob=>{

            finalBlob = blob;
            downloadBtn.disabled = false;

            status.textContent = "Ready ✅";

        },"image/png",1.0);

    };

    img.src = URL.createObjectURL(file);

});


// Enhance
function enhanceImage(){

    let data = ctx.getImageData(0,0,canvas.width,canvas.height);
    let d = data.data;

    for(let i=0;i<d.length;i+=4){

        let r=d[i], g=d[i+1], b=d[i+2];

        // Brightness
        r*=1.06; g*=1.06; b*=1.06;

        // Contrast
        r=(r-128)*1.18+128;
        g=(g-128)*1.18+128;
        b=(b-128)*1.18+128;

        // Saturation
        let avg=(r+g+b)/3;

        r=avg+(r-avg)*1.3;
        g=avg+(g-avg)*1.3;
        b=avg+(b-avg)*1.3;

        d[i]=clamp(r);
        d[i+1]=clamp(g);
        d[i+2]=clamp(b);
    }

    ctx.putImageData(data,0,0);
}


// Watermark
function addLogo(){

    const scale = canvas.width * 0.15 / logo.width;

    const w = logo.width * scale;
    const h = logo.height * scale;

    const x = canvas.width - w - 20;
    const y = canvas.height - h - 20;

    ctx.globalAlpha = 0.7;
    ctx.drawImage(logo,x,y,w,h);
    ctx.globalAlpha = 1;
}


function clamp(v){
    return Math.max(0,Math.min(255,v));
}


// Download (Guaranteed)
downloadBtn.addEventListener("click",()=>{

    if(!finalBlob){
        alert("No file ready yet");
        return;
    }

    const url = URL.createObjectURL(finalBlob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "selelo_branded.png";

    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);

    URL.revokeObjectURL(url);

});

</script>

</body>
</html>
